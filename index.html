document.getElementById("sendBtn").addEventListener("click", async () => {
  const text = playlistOutput.value.trim();
  if (!text) {
    setStatus("Nothing to send yet. Click 'Create My Marathon' first.");
    return;
  }

  const selectedClean = getSelectedShows();
  const activeBtn = document.querySelector(".target-buttons button.active");
  const hours = activeBtn ? activeBtn.dataset.hours : "12";
  const senderName = document.getElementById("senderName").value.trim();
  const userTitle = document.getElementById("userTitle").value.trim();
  const backgroundChoice = getSelectedBackground();

  const payload = {
    playlist: text,
    shows_selected: selectedClean.join(", "),
    target_hours: hours,
    sender_name: senderName,
    user_title: userTitle,
    background_choice: backgroundChoice
  };

  setStatus("Sending playlist to Wade...");

  try {
    const res = await fetch("https://formspree.io/f/mqarbnyg", {
      method: "POST",
      headers: {
        "Accept": "application/json",
        "Content-Type": "application/json"
      },
      body: JSON.stringify(payload)
    });

    if (res.ok) {
      setStatus("Sent! Your marathon request has been delivered.");
      // Optional: clear selections after send
      // showsContainer.querySelectorAll("input[type=checkbox]").forEach(cb => cb.checked = false);
      // playlistOutput.value = "";
    } else {
      setStatus("There was a problem sending your request. Please try again later.");
    }
  } catch (err) {
    console.error(err);
    setStatus("Network error while sending your request.");
  }
});
