<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Golden Radio Hour – Marathon Builder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #111;
      color: #f5f5f5;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px 16px 40px;
    }
    h1 {
      font-size: 1.8rem;
      margin-bottom: 0.25rem;
    }
    h2 {
      font-size: 1.2rem;
      margin-top: 1.5rem;
      margin-bottom: 0.5rem;
    }
    .card {
      background: #1b1b1b;
      border-radius: 8px;
      padding: 16px;
      margin-top: 12px;
      border: 1px solid #333;
    }
    .shows-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 6px 14px;
      max-height: 260px;
      overflow-y: auto;
      padding-right: 6px;
    }
    label.show-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
      cursor: pointer;
    }
    label.show-item input {
      transform: scale(1.2);
    }
    .target-buttons button {
      margin: 4px 6px 4px 0;
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid #555;
      background: #222;
      color: #eee;
      cursor: pointer;
      font-size: 0.9rem;
    }
    .target-buttons button.active {
      border-color: #ffd54f;
      background: #333;
    }
    .actions {
      margin-top: 12px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .actions button {
      padding: 10px 18px;
      border-radius: 6px;
      border: none;
      font-size: 0.95rem;
      cursor: pointer;
    }
    #buildBtn {
      background: #ffd54f;
      color: #111;
      font-weight: 600;
    }
    #clearBtn {
      background: #333;
      color: #eee;
    }
    #sendBtn {
      background: #4caf50;
      color: #111;
      font-weight: 600;
    }
    #playlistOutput {
      display: none; /* Hidden output */
      width: 100%;
      min-height: 180px;
      background: #0d0d0d;
      color: #eee;
      border-radius: 6px;
      border: 1px solid #333;
      padding: 10px;
      font-family: Consolas, Menlo, monospace;
      font-size: 0.9rem;
      resize: vertical;
    }
    .small {
      font-size: 0.8rem;
      color: #aaa;
    }
    .top-note {
      font-size: 0.85rem;
      color: #bbb;
      margin-bottom: 0.5rem;
    }
    #status {
      margin-top: 6px;
      font-size: 0.85rem;
      color: #ccc;
    }
    #senderName {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
      border-radius: 6px;
      border: 1px solid #333;
      background: #0d0d0d;
      color: #eee;
      font-size: 0.9rem;
    }
    @media (max-width: 600px) {
      h1 {
        font-size: 1.4rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Golden Radio Hour – Marathon Builder</h1>
    <div class="top-note">
      Choose your favorite shows, pick a marathon length, and send a custom marathon request. Wade will build the final playlist based on your selections.
    </div>

    <!-- Show picker -->
    <div class="card">
      <h2>1. Choose Shows</h2>
      <div id="showsContainer" class="shows-grid"></div>
      <div class="small" style="margin-top:6px;">
        Select one or more shows you want included in your custom marathon.
      </div>
    </div>

    <!-- Length picker -->
    <div class="card">
      <h2>2. Choose Target Length</h2>
      <div class="target-buttons">
        <button type="button" data-hours="3">3 hours</button>
        <button type="button" data-hours="6">6 hours</button>
        <button type="button" data-hours="9">9 hours</button>
        <button type="button" data-hours="12" class="active">12 hours</button>
      </div>
      <div class="small">
        The builder will try to get as close to this length as possible.
      </div>
    </div>

    <!-- Request sender -->
    <div class="card">
      <h2>3. Send Your Request</h2>

      <div class="small">Your name or nickname (optional):</div>
      <input id="senderName" type="text" placeholder="Example: Mary from Seattle" />

      <div class="actions">
        <button id="buildBtn">Create My Marathon</button>
        <button id="clearBtn">Clear Selection</button>
        <button id="sendBtn">Send to Wade</button>
      </div>
      <div id="status"></div>

      <!-- Hidden playlist output -->
      <textarea id="playlistOutput"></textarea>

      <div class="small">
        “Send to Wade” emails your request directly to him with all internal details. He will assemble the final marathon.
      </div>
    </div>
  </div>

  <!-- Formspree -->
  <form id="sendForm" action="https://formspree.io/f/mqarbnyg" method="POST" style="display:none;">
    <input type="hidden" name="playlist" id="playlistField">
    <input type="hidden" name="shows_selected" id="showsField">
    <input type="hidden" name="target_hours" id="hoursField">
    <input type="hidden" name="sender_name" id="senderNameField">
  </form>

  <script>
    let library = [];
    let allShows = [];
    let targetSeconds = 12 * 3600;

    /* YOUR APPROVED FULL SHOW LIST */
    const allowedShows = [
      "BBC Christmas Stories","BBC Radio","BBC Stories","Beyond Midnight",
      "Bob Bailey As Yours Truly","Bob Bailey Singles","Boston Blackie","Box 13",
      "Broadway Is My Beat","Candy Matson","Casey Crime Photographer","CBC Mystery Theatre",
      "CBS Radio Mystery Theater","CBS Radio Workshop","CBSRMT","Crime Classics",
      "Crisis","Damon Runyon","Dangerous Assignment","Dangerously Yours","Dark Fantasy",
      "Dimension X","Dr. Christian","Dr. Kildare","Dragnet","Edmond Obrien",
      "Father Knows Best","Fibber McGee and Molly","Fort Laramie","Frontier Gentleman",
      "Gunsmoke","Have Gun Will Travel","Horror Stories","Inner Sanctum Mysteries",
      "Jeff Regan","Let George Do It","Let George Sherlock Holmes Mash","Lights Out",
      "Lux Radio Theatre","Man Called X","Mandel Kramer","Michael Shayne",
      "Molle Mystery Theater","Mystery Is My Hobby","Nero Wolfe",
      "Nick Carter, Master Detective","Obsession","Pat Novak, For Hire",
      "Philip Marlowe","Philo Vance","Ray Bradbury Theater","Red Skelton Show",
      "Rogues Gallery","Roy Rogers Show","Sam Spade","Screen Directors Playhouse",
      "Screen Guild Theater","Sears Radio Theater","Sherlock & Wolfe","Sherlock Holmes",
      "Spade","Stories of Sherlock Holmes","Strange Wills","Summer Spook Radio Dramas",
      "Suspense","Tales of the Texas Rangers","The Falcon","The Great Gildersleeve",
      "The Jack Benny Program","The Mysterious Traveler","The New Adventures of Sherlock Holmes",
      "The Saint","The Whistler","Theater Five","This Is Your FBI",
      "Twilight Zone Radio Dramas","Vincent Price as The Saint",
      "Weird Circle","X Minus One",
      "Yours Truly, Johnny Dollar","Yours Truly, Johnny Dollar (Bob Bailey)",
      "Yours Truly, Johnny Dollar (Edmond O'Brien)","Yours Truly, Johnny Dollar (John Lund)",
      "Yours Truly, Johnny Dollar (Mandel Kramer)",
      "Yours Truly, Johnny Dollar (Robert Readick)"
    ];

    const showsContainer = document.getElementById("showsContainer");
    const playlistOutput = document.getElementById("playlistOutput");
    const statusElem = document.getElementById("status");

    function setStatus(msg) {
      statusElem.textContent = msg || "";
    }

    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
    }

    function secondsToHMS(sec) {
      sec = Math.max(0, Math.floor(sec));
      const h = String(Math.floor(sec / 3600)).padStart(2, "0");
      const m = String(Math.floor((sec % 3600) / 60)).padStart(2, "0");
      const s = String(sec % 60).padStart(2, "0");
      return `${h}:${m}:${s}`;
    }

    function buildShowsUI() {
      const set = new Set(
        library.map(e => e.show).filter(show => allowedShows.includes(show))
      );
      const sorted = [...set].sort((a, b) => a.localeCompare(b));
      showsContainer.innerHTML = "";

      sorted.forEach(show => {
        const id = "show_" + show.replace(/\W+/g, "_");

        const label = document.createElement("label");
        label.className = "show-item";

        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.value = show;

        const span = document.createElement("span");
        span.textContent = show;

        label.append(cb, span);
        showsContainer.append(label);
      });
    }

    function getSelectedShows() {
      return [...showsContainer.querySelectorAll("input:checked")].map(x => x.value);
    }

    function buildMarathon() {
      const selectedShows = getSelectedShows();
      if (!selectedShows.length) {
        setStatus("Please select at least one show.");
        return;
      }

      const pool = library.filter(e => selectedShows.includes(e.show));
      if (!pool.length) {
        setStatus("No episodes found for selected shows.");
        return;
      }

      shuffle(pool);

      let total = 0;
      let chosen = [];

      for (const ep of pool) {
        if (total + ep.duration_seconds > targetSeconds + 300) continue;
        chosen.push(ep);
        total += ep.duration_seconds;
        if (total >= targetSeconds) break;
      }

      if (!chosen.length) {
        setStatus("Could not fit any episodes.");
        return;
      }

      let txt = "";
      let run = 0;

      chosen.forEach((ep, i) => {
        txt += `${i+1}. ${secondsToHMS(run)} ${ep.show} - ${ep.episode_title}\n`;
        run += ep.duration_seconds;
      });

      txt += `\nTotal duration: ${secondsToHMS(run)}`;

      playlistOutput.value = txt;
      setStatus("Playlist created. Click Send to Wade.");
    }

    document.getElementById("buildBtn").onclick = buildMarathon;
    document.getElementById("clearBtn").onclick = () => {
      showsContainer.querySelectorAll("input").forEach(i => i.checked = false);
      playlistOutput.value = "";
      setStatus("");
    };

    document.getElementById("sendBtn").onclick = () => {
      const txt = playlistOutput.value.trim();
      if (!txt) return setStatus("Nothing to send yet.");

      const selected = getSelectedShows().join(", ");
      const hours = document.querySelector(".target-buttons .active")?.dataset.hours || "12";
      const name = document.getElementById("senderName").value.trim();

      playlistField.value = txt;
      showsField.value = selected;
      hoursField.value = hours;
      senderNameField.value = name;

      setStatus("Sending request...");
      sendForm.submit();
    };

    fetch("library.json")
      .then(r => r.json())
      .then(data => {
        library = data;
        setStatus(`Library loaded (${library.length} episodes).`);
        buildShowsUI();
      })
      .catch(() => setStatus("Error loading library.json."));
  </script>
</body>
</html>
